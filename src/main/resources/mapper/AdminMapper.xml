<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.vam.mapper.AdminMapper">

    <!-- 작가 등록 -->
    <insert id="bookEnroll" parameterType="com.vam.domain.BookVO">
        INSERT INTO vam_book (
            bookName,
            authorId,
            publeYear,
            publisher,
            cateCode,
            bookPrice,
            bookStock,
            bookDiscount,
            bookIntro,
            bookContents
        )
        VALUE (
            #{bookName},
            #{authorId},
            #{publeYear},
            #{publisher},
            #{cateCode},
            #{bookPrice},
            #{bookStock},
            #{bookDiscount},
            #{bookIntro},
            #{bookContents}
        )
    </insert>

    <!-- 카테고리 리스트 -->
    <select id="cateList" resultType="com.vam.domain.CateVO">
        SELECT * FROM vam_bcate ORDER BY catecode;
    </select>

    <!-- 상품 리스트 -->
    <select id="goodsGetList" resultType="com.vam.domain.BookVO">
        SELECT
            bookId, bookName, b.authorName, c.cateName, bookStock, a.regDate
        FROM vam_book a
        LEFT OUTER JOIN vam_author b ON a.authorId = b.authorId
        LEFT OUTER JOIN vam_bcate c ON a.cateCode = c.cateCode
        <if test="keyword != null">
            WHERE (bookName LIKE CONCAT('%', #{keyword}, '%'))
        </if>
        ORDER BY bookId DESC
        LIMIT #{skip}, #{amount}
    </select>

    <!-- 상품 총 개수 -->
    <select id="goodsGetTotal" resultType="int">
        SELECT COUNT(*) FROM vam_book
        <if test="keyword != null">
            WHERE bookName LIKE CONCAT('%', #{keyword}, '%')
        </if>
    </select>

    <!-- 상품 조회 페이지 -->
    <select id="goodsGetDetail" resultType="com.vam.domain.BookVO">
        SELECT
            bookId,
            bookName,
            (SELECT authorName FROM vam_author WHERE authorID = vam_book.authorId) authorName,
           authorId,
           publeYear,
           publisher,
           cateCode,
           bookPrice,
           bookStock,
           bookDiscount,
           bookIntro,
           bookContents,
           regDate,
           updateDate
        FROM vam_book
        WHERE
            bookId = #{bookId}

    </select>

    <update id="goodsModify">
        UPDATE
            vam_book
        SET
            bookName = #{bookName},
            authorId = #{authorId},
            publeYear = #{publeYear},
            publisher = #{publisher},
            cateCode = #{cateCode},
            bookPrice = #{bookPrice},
            bookStock = #{bookStock},
            bookDiscount = #{bookDiscount},
            bookIntro = #{bookIntro},
            bookContents = #{bookContents},
            updateDate = now()
        WHERE bookId = #{bookId}
    </update>

</mapper>